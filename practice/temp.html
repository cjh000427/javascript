<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

    <title>Document</title>

    <style>
        .final {
            width: 703px;
            height: 800px;
            display: flex;
            flex-wrap: wrap;
            border: 0px solid red;
            margin: 60px auto;
        }

        .wrap {
            width: 500px;
            height: 600px;
            border: 1px solid red;
            border-radius: 5px;
            overflow: auto;
        }

        input {
            box-sizing: border-box;
            width: 50px;
            height: 50px;
            text-align: center;
            font-size: 32px;
            border: 1px solid black;
            border-radius: 5px;
        }

        button {
            width: 500px;
            box-sizing: border-box;
        }

        .wrap::-webkit-scrollbar {
            display: none;
        }

        body::-webkit-scrollbar {
            display: none;
        }

        .sidebar {
            box-sizing: border-box;
            width: 199px;
            height: 602px;
            border: 1px solid red;
            border-radius: 5px;
        }

        .keyboard {
            box-sizing: border-box;
            width: 502px;
            height: 200px;
            border: 1px solid red;
            border-radius: 5px;
        }

        .status {
            width: 200px;
            height: 200px;
            border: 1px solid red;
            box-sizing: border-box;
            border-radius: 5px;

            background: url(./hearth/hearth3.jpg) center;

        }

        /*  */

        .tool {
            width: 80%;
            height: 20%;
            margin: 3% auto 0;
            border: 1px solid white;
            text-align: center;
            border-radius: 20px;
            color: greenyellow;


        }

        .tool:hover {
            cursor: pointer;
            border: 3px solid white;
            font-weight: bold;
        }

        .btn-lang {
            width: 20px;
            height: 40px;
            margin-left: 10px;
        }
        

        
    </style>

</head>

<body>
    <div class="final">
        <div class="wrap animate__animated animate__bounceInDown">
            <div class="temp">
            </div>
        </div>
        <div class="sidebar animate__animated animate__bounceInRight"> 사이드 메뉴


        </div>
        <div class="keyboard animate__animated animate__bounceInUp"> 키보드</div>
        <div class="status animate__animated animate__bounceInRight">
            <div class="tool">남은 기회 <br> 0</div>
            <div class="tool">글자 수 선택</div>
            <div class="tool">
                <button class="btn-lang left"> ← </button>
                <span class="eng">English</span>  <span class="kor"></span>
                <button class="btn-lang right">→</button>
            </div>
            <div class="tool">처음화면으로 <br>돌아가기</div>
        </div>



    </div>



    <script>
        let l = 5; //사용자가 원하는 단어 길이
        let correct = 0;
        let flag = false;
        const $wrap = document.querySelector('.wrap');
        const $btn = document.querySelector('button');
        const $div = document.querySelector('div.temp');

        //영어단어 데이터
        const eng = [
            'and', 'but', 'cow', //0~2번
            'into', 'rock', 'gift', //3~5번
            'vocal', 'utill', 'hover', //6~8번
            'bottom', 'attack', 'travel', //6~8번
        ];


        //랜덤단어 선정
        if (l == 3) var answer = eng[Math.floor(Math.random() * 3)];
        else if (l == 4) var answer = eng[Math.floor(Math.random() * 3) + 3];
        else if (l == 5) var answer = eng[Math.floor(Math.random() * 3) + 6];
        else if (l == 6) var answer = eng[Math.floor(Math.random() * 3) + 9];
        console.log('정답지 : ' + answer);



        //글자수대로 초기박스생성
        for (let i = 0; i < answer.length; i++) {
            //input 생성
            const $new = document.createElement('input');
            $new.setAttribute('type', 'text');
            $new.setAttribute('maxlength', '1');
            $new.setAttribute('onkeyup', 'moveFocus(' + i + ')'); // 키보드이벤트1 추가
            $new.setAttribute('class', 'list');
            $div.appendChild($new);

            //마지막박스 생성 후
            if (i === answer.length - 1) {
                //다음 버튼생성
                const $newbtn = document.createElement('button');
                $newbtn.textContent = '확인';
                $div.appendChild($newbtn);
            }
            $new.style.width = (500 / answer.length) + "px";
            $new.style.height = (500 / answer.length) + "px";
        }




        //키보드 이벤트1 : 포커스제어===============
        function moveFocus(i) {
            const $inputFocus = document.querySelectorAll('.list');
            if (i == answer.length - 1 && event.key == 'Enter') { //마지막칸 enter 체점 후 다음라인 생성
                const $div = document.querySelector('div.temp');
                const $input = document.querySelectorAll('.list');
                check($div, $input);
                if (!flag) creatInput($div);
                $inputFocus[i].blur();
                return;
            }

            if (event.key == 'Escape') { //esc 누르면 input 포커스 아웃  
                $inputFocus[i].blur();
            }
            if (!(i == answer.length - 1) && event.keyCode !== 8) $inputFocus[i + 1].focus();
        }

        //마우스 이벤트===============
        $wrap.addEventListener('click', e => {

            const $div = document.querySelector('div.temp');
            if (!e.target.matches('.temp button')) return; //버튼말고는 클릭이벤트 없음
            const $input = e.target.parentNode.querySelectorAll('input');
            check($div, $input);
            if (!flag) creatInput($div);
        });

        //글자 채점 로직 함수===============
        function check($div, $input) {
            for (let i = 0; i < answer.length; i++) {
                if ($input[i].value == answer[i]) {
                    $input[i].style.background = 'green';
                    correct++;
                    if (correct == answer.length) { //=============승리 : 초록칸갯수=글자길이==================
                        victory();
                    }
                } else if (answer.includes($input[i].value) && $input[i].value !== '') {
                    $input[i].style.background = 'yellow';
                } else {
                    $input[i].style.background = 'lightgrey';
                }
            }
            const $inputFocus = document.querySelectorAll('.list');
            for (let i = 0; i < answer.length; i++) {
                $inputFocus[i].classList.remove('list'); //기존 키보드 이벤트1 권한 제거
            }

        }

        //다음라인 생성 함수===============
        function creatInput($div) {
            const $clone = $div.cloneNode(true);
            const $inputs = $clone.querySelectorAll('input');
            for (let $ele of [...$inputs]) {
                $ele.value = '';
                $ele.style.background = 'white';
                $ele.classList.add('list'); //새로운 라인 키보드 이벤트1 권한 부여
            }

            const $btn = document.querySelector('button');
            $btn.remove(); //지난라인 버튼제거            
            $wrap.appendChild($clone);
            $div.classList.remove('temp');
            $inputs[0].focus(); // 생성된 다음라인 첫칸 포커스
            correct = 0; //녹색갯수 초기화
            $wrap.scrollTop = $wrap.scrollHeight; //스크롤 최하단 유지
        }


        //승리시 정답함수===============
        function victory() {
            alert('정답입니다!');
            flag = true // 승리시 추가 라인 생성없음
        };


        // 상태 창

        // 처음화면 돌아가는 로직
        const $reload = document.querySelector('.status .tool:nth-child(4)');
        $reload.addEventListener('click', e => {
            location.reload();
        });

        // 언어 선택
   
        let count = 0;
        const $selectLang = document.querySelector('.status .tool:nth-child(3)');
        const $btnRight = document.querySelector('.right');
        const $btnLeft = document.querySelector('.left');
        const $eng = document.querySelector('.eng');
        const $kor = document.querySelector('.kor');
        $selectLang.addEventListener('click', e => {
            count++;
            if (!e.target.matches('.right')) {
                console.log('부모요소는 이벤트 발생 안함!');
                return;
            }

           if(count === 1) {
            $eng.textContent = '';
            $kor.textContent = 'Korean';
           }
        });
        $selectLang.addEventListener('click', e => {
            count--;
            if (!e.target.matches('.left')) {
                console.log('부모요소는 이벤트 발생 안함!');
                return;
            }

           if(count === 0) {
            $eng.textContent = 'English';
            $kor.textContent = '';
           }
        });

        // 글자 수 선택


    </script>


</body>

</html>